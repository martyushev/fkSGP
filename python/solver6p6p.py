import numpy as np
from numpy.linalg import norm
from scipy.sparse import csr_matrix
from scipy.linalg import lu, qr, solve, eig
from .cayley import cayley



# forward kinematics of fully planar 6P-6P Stewart-Gough platform
#
# input:
#  X - 6x3 matrix with coordinates of attachment points on the base
#  platform, first row and last column of X are assumed to be zero
#  x - 6x3 matrix with coordinates of attachment points on the top
#  platform, first row and last column of x are assumed to be zero
#  L - 6-vector of squared leg lengths
#  realOnly - real postures only flag (0/1)
#
# output:
#  Rt  - kx3x4 array of estimated rigid-body transformations
#  err - k-vector of errors
def solver6p6p(X,x,L,realOnly):

    C,U,RR = coefs6p6p(X,x,L)
    S = red_171x210_6p6p(C,L[0])
    Rt,err = S2Rt6p6p(S,C,U,RR,realOnly)

    return Rt,err



def coefs6p6p(X,x,L):

    RR = np.empty((2,3,3)) # random rotations to prevent dummy singularities
    RR[0,:,:] = cayley(np.array([0,0,np.random.randn()]))
    RR[1,:,:] = cayley(np.array([0,0,np.random.randn()]))
    X = X@RR[0,:,:]
    x = x@RR[1,:,:]

    X = X.T.flat
    x = x.T.flat
    L = L.T.flat

    C = np.zeros((12,44))

    C.flat[[278,323,368,413,451,493]] = -1
    C.flat[[25,30,42,44,45,47,48,50,51,52,69,74,75,77,86,88,89,91,92,94,95,96,113,118,119,121,130,132,133,135,136,138,139,140,157,162,163,165,174,176,177,179,180,182,183,184,201,206,207,209,218,220,221,223,224,226,227,228,245,250,251,253,262,274,321,384,429,471,496]] = 1
    C.flat[43] = -L[0]
    C.flat[73] = -4*x[1]
    C.flat[[62,71,82]] = 4*x[1]
    C.flat[117] = -4*x[2]
    C.flat[[106,115,126]] = 4*x[2]
    C.flat[161] = -4*x[3]
    C.flat[[150,159,170]] = 4*x[3]
    C.flat[205] = -4*x[4]
    C.flat[[194,203,214]] = 4*x[4]
    C.flat[249] = -4*x[5]
    C.flat[[238,247,258]] = 4*x[5]
    C.flat[80] = -4*x[7]
    C.flat[[63,66,68]] = 4*x[7]
    C.flat[124] = -4*x[8]
    C.flat[[107,110,112]] = 4*x[8]
    C.flat[168] = -4*x[9]
    C.flat[[151,154,156]] = 4*x[9]
    C.flat[212] = -4*x[10]
    C.flat[[195,198,200]] = 4*x[10]
    C.flat[256] = -4*x[11]
    C.flat[[239,242,244]] = 4*x[11]
    C.flat[[90,111]] = -2*X[2]-2*x[2]
    C.flat[[109,128]] = -2*X[2]+2*x[2]
    C.flat[[197,216]] = -2*X[4]+2*x[4]
    C.flat[[49,70]] = -2*X[7]-2*x[7]
    C.flat[[93,114]] = -2*X[8]-2*x[8]
    C.flat[[116,129]] = -2*X[8]+2*x[8]
    C.flat[[46,67]] = -2*x[1]-2*X[1]
    C.flat[[65,84]] = 2*x[1]-2*X[1]
    C.flat[[134,155]] = -2*x[3]-2*X[3]
    C.flat[[153,172]] = 2*x[3]-2*X[3]
    C.flat[[178,199]] = -2*x[4]-2*X[4]
    C.flat[[222,243]] = -2*x[5]-2*X[5]
    C.flat[[241,260]] = 2*x[5]-2*X[5]
    C.flat[[72,85]] = 2*x[7]-2*X[7]
    C.flat[[137,158]] = -2*x[9]-2*X[9]
    C.flat[[160,173]] = 2*x[9]-2*X[9]
    C.flat[[181,202]] = -2*x[10]-2*X[10]
    C.flat[[204,217]] = 2*x[10]-2*X[10]
    C.flat[[225,246]] = -2*x[11]-2*X[11]
    C.flat[[248,261]] = 2*x[11]-2*X[11]
    C.flat[79] = -4*X[1]*x[7]-4*X[7]*x[1]
    C.flat[83] = -4*X[1]*x[7]+4*X[7]*x[1]
    C.flat[123] = -4*X[2]*x[8]-4*X[8]*x[2]
    C.flat[127] = -4*X[2]*x[8]+4*X[8]*x[2]
    C.flat[167] = -4*X[3]*x[9]-4*X[9]*x[3]
    C.flat[171] = -4*X[3]*x[9]+4*X[9]*x[3]
    C.flat[211] = -4*X[4]*x[10]-4*X[10]*x[4]
    C.flat[215] = -4*X[4]*x[10]+4*X[10]*x[4]
    C.flat[255] = -4*X[5]*x[11]-4*X[11]*x[5]
    C.flat[259] = -4*X[5]*x[11]+4*X[11]*x[5]
    C.flat[87] = X[1]**2-2*X[1]*x[1]+X[7]**2-2*X[7]*x[7]+x[1]**2+x[7]**2-L[1]
    C.flat[78] = X[1]**2-2*X[1]*x[1]+X[7]**2+2*X[7]*x[7]+x[1]**2+x[7]**2-L[1]
    C.flat[81] = X[1]**2+2*X[1]*x[1]+X[7]**2-2*X[7]*x[7]+x[1]**2+x[7]**2-L[1]
    C.flat[64] = X[1]**2+2*X[1]*x[1]+X[7]**2+2*X[7]*x[7]+x[1]**2+x[7]**2-L[1]
    C.flat[131] = X[2]**2-2*X[2]*x[2]+X[8]**2-2*X[8]*x[8]+x[2]**2+x[8]**2-L[2]
    C.flat[122] = X[2]**2-2*X[2]*x[2]+X[8]**2+2*X[8]*x[8]+x[2]**2+x[8]**2-L[2]
    C.flat[125] = X[2]**2+2*X[2]*x[2]+X[8]**2-2*X[8]*x[8]+x[2]**2+x[8]**2-L[2]
    C.flat[108] = X[2]**2+2*X[2]*x[2]+X[8]**2+2*X[8]*x[8]+x[2]**2+x[8]**2-L[2]
    C.flat[175] = X[3]**2-2*X[3]*x[3]+X[9]**2-2*X[9]*x[9]+x[3]**2+x[9]**2-L[3]
    C.flat[166] = X[3]**2-2*X[3]*x[3]+X[9]**2+2*X[9]*x[9]+x[3]**2+x[9]**2-L[3]
    C.flat[169] = X[3]**2+2*X[3]*x[3]+X[9]**2-2*X[9]*x[9]+x[3]**2+x[9]**2-L[3]
    C.flat[152] = X[3]**2+2*X[3]*x[3]+X[9]**2+2*X[9]*x[9]+x[3]**2+x[9]**2-L[3]
    C.flat[219] = X[4]**2-2*X[4]*x[4]+X[10]**2-2*X[10]*x[10]+x[4]**2+x[10]**2-L[4]
    C.flat[210] = X[4]**2-2*X[4]*x[4]+X[10]**2+2*X[10]*x[10]+x[4]**2+x[10]**2-L[4]
    C.flat[213] = X[4]**2+2*X[4]*x[4]+X[10]**2-2*X[10]*x[10]+x[4]**2+x[10]**2-L[4]
    C.flat[196] = X[4]**2+2*X[4]*x[4]+X[10]**2+2*X[10]*x[10]+x[4]**2+x[10]**2-L[4]
    C.flat[263] = X[5]**2-2*X[5]*x[5]+X[11]**2-2*X[11]*x[11]+x[5]**2+x[11]**2-L[5]
    C.flat[254] = X[5]**2-2*X[5]*x[5]+X[11]**2+2*X[11]*x[11]+x[5]**2+x[11]**2-L[5]
    C.flat[257] = X[5]**2+2*X[5]*x[5]+X[11]**2-2*X[11]*x[11]+x[5]**2+x[11]**2-L[5]
    C.flat[240] = X[5]**2+2*X[5]*x[5]+X[11]**2+2*X[11]*x[11]+x[5]**2+x[11]**2-L[5]

    C = C/norm(C,axis=1,keepdims=True)

    def U(s):
        return np.array([s[5]**2*s[6]**2,s[5]**2*s[7]**2,s[5]**2*s[6],s[0]*s[6]**2,s[3]*s[6]**2,s[5]**2*s[7],s[0]*s[7]**2,s[3]*s[7]**2,s[5]**2*s[8],s[1]**2,s[2]*s[1],s[2]**2,s[3]*s[0],s[3]*s[2],s[4]*s[0],s[4]*s[1],s[4]*s[2],s[4]**2,s[5]*s[2],s[5]*s[4],s[5]**2,s[6]*s[0],s[6]*s[1],s[6]*s[3],s[6]*s[5],s[6]**2,s[7]*s[0],s[7]*s[1],s[7]*s[3],s[7]*s[5],s[7]**2,s[0]*s[8],s[1]*s[8],s[3]*s[8],s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],1])

    return C,U,RR



# Input: coefficient matrix C of size 12x44
# Output: solution matrix S of size 9x39
def red_171x210_6p6p(C,L0):

    M = csr_matrix((C.flat[[44,47,48,69,46,65,66,67,70,71,50,51,72,74,75,77,78,79,80,81,82,84,85,86,87,45,49,52,62,63,64,68,73,83,44,47,48,69,46,49,62,63,78,79,81,87,64,83,44,47,48,69,45,52,66,78,79,65,67,70,71,72,80,81,82,84,85,87,46,49,62,63,64,68,73,83,44,46,47,48,65,66,67,68,69,84,45,52,64,71,78,79,81,70,72,80,82,85,87,49,62,63,73,83,44,47,48,69,45,46,49,52,62,63,64,65,66,67,68,70,71,50,51,72,73,74,75,77,78,79,80,81,82,83,84,85,86,87,44,47,48,62,63,69,80,82,45,46,49,52,64,65,66,67,70,71,72,78,79,81,84,85,87,68,73,83,44,47,48,62,69,80,45,46,49,65,66,67,68,70,71,72,75,77,78,79,81,84,74,82,85,86,87,52,63,64,73,83,44,47,48,62,63,66,67,69,71,72,77,79,80,81,82,45,46,49,52,64,65,70,78,84,85,87,68,73,83,44,47,48,62,66,69,71,79,80,45,46,49,65,67,68,70,72,73,75,77,78,81,84,85,74,82,86,87,52,63,64,83,44,47,48,69,45,46,49,65,66,67,68,70,71,72,73,75,77,78,79,81,84,85,74,80,82,86,87,52,62,63,64,83,44,47,48,69,46,49,62,63,64,65,66,68,73,80,82,78,79,81,83,87,44,47,48,62,69,80,46,49,63,78,79,81,87,64,83,44,47,48,62,66,69,71,79,80,46,49,63,68,78,81,87,64,83,44,47,48,69,46,49,62,63,68,78,79,81,87,64,83,44,46,47,48,65,66,67,68,69,84,49,62,63,79,78,81,87,64,83,44,47,48,69,46,49,52,62,63,64,66,78,79,65,67,68,70,71,72,73,80,81,82,83,84,85,87,44,47,48,69,46,49,62,63,64,68,73,78,79,81,87,83,44,47,48,69,80,46,49,52,62,63,64,65,78,79,81,82,84,85,87,68,73,83,44,47,48,69,79,81,46,49,62,63,64,66,67,68,73,78,87,83,44,47,48,66,69,71,79,80,46,49,52,62,63,64,68,78,81,82,83,84,87,85,73,44,47,48,69,46,49,52,62,63,64,67,78,79,80,81,82,83,87,84,85,68,73,44,46,47,48,49,52,62,63,64,65,66,67,68,69,70,71,72,73,75,77,78,79,80,81,82,83,84,85,86,87,44,46,47,48,65,66,67,68,69,84,49,52,62,63,64,71,75,78,79,81,83,70,72,73,80,82,85,87,44,46,47,48,65,66,67,68,69,84,49,62,63,64,73,78,79,81,87,83,44,46,47,48,65,66,67,68,69,80,84,49,52,62,63,64,70,78,79,81,82,83,87,85,73,44,46,47,48,65,66,67,68,69,79,81,84,49,62,63,64,71,72,73,78,87,83,44,46,47,48,65,66,67,68,69,71,79,80,84,49,52,62,63,64,73,78,81,82,83,85,87,44,46,47,48,65,66,67,68,69,84,49,52,62,63,64,72,78,79,80,81,82,83,87,85,73,44,47,48,69,46,49,50,51,62,63,64,65,66,67,68,70,71,72,73,80,82,83,84,74,75,77,78,79,81,85,86,87,44,47,48,69,80,82,46,49,62,63,64,65,66,67,68,70,71,72,73,74,75,77,83,86,78,79,81,84,85,87,44,47,48,69,77,79,80,81,82,46,49,62,63,64,65,66,67,68,70,71,72,73,74,75,83,86,78,84,85,87,44,47,48,62,69,71,79,80,46,49,63,64,68,73,84,85,87,83,44,47,48,69,82,46,49,62,63,64,68,73,84,85,87,83,44,47,48,62,63,65,66,69,71,72,78,79,80,81,82,83,84,85,86,87,46,49,64,68,73,44,47,48,62,63,65,66,67,69,71,72,78,79,80,81,82,83,84,85,86,87,46,49,64,68,73,88,91,92,113,90,109,110,111,114,115,94,95,116,118,119,121,122,123,124,125,126,128,129,130,131,89,93,96,106,107,108,112,117,127,88,91,92,113,90,93,106,107,122,123,125,131,108,127,88,91,92,113,89,96,110,122,123,109,111,114,115,116,124,125,126,128,129,131,90,93,106,107,108,112,117,127,88,90,91,92,109,110,111,112,113,128,89,96,108,115,122,123,125,114,116,124,126,129,131,93,106,107,117,127,88,91,92,113,89,90,93,96,106,107,108,109,110,111,112,114,115,94,95,116,117,118,119,121,122,123,124,125,126,127,128,129,130,131,88,91,92,106,107,113,124,126,89,90,93,96,108,109,110,111,114,115,116,122,123,125,128,129,131,112,117,127,88,91,92,106,113,124,89,90,93,109,110,111,112,114,115,116,119,121,122,123,125,128,118,126,129,130,131,96,107,108,117,127,88,91,92,106,107,110,111,113,115,116,121,123,124,125,126,89,90,93,96,108,109,114,122,128,129,131,112,117,127,88,91,92,106,110,113,115,123,124,89,90,93,109,111,112,114,116,117,119,121,122,125,128,129,118,126,130,131,96,107,108,127,88,91,92,113,89,90,93,109,110,111,112,114,115,116,117,119,121,122,123,125,128,129,118,124,126,130,131,96,106,107,108,127,88,91,92,113,90,93,106,107,108,109,110,112,117,124,126,122,123,125,127,131,88,91,92,106,113,124,90,93,107,122,123,125,131,108,127,88,91,92,106,110,113,115,123,124,90,93,107,112,122,125,131,108,127,88,91,92,113,90,93,106,107,112,122,123,125,131,108,127,88,90,91,92,109,110,111,112,113,128,93,106,107,123,122,125,131,108,127,88,91,92,113,90,93,96,106,107,108,110,122,123,109,111,112,114,115,116,117,124,125,126,127,128,129,131,88,91,92,113,90,93,106,107,108,112,117,122,123,125,131,127,88,91,92,113,124,90,93,96,106,107,108,109,122,123,125,126,128,129,131,112,117,127,88,91,92,113,123,125,90,93,106,107,108,110,111,112,117,122,131,127,88,91,92,110,113,115,123,124,90,93,96,106,107,108,112,122,125,126,127,128,131,129,117,88,91,92,113,90,93,96,106,107,108,111,122,123,124,125,126,127,131,128,129,112,117,88,90,91,92,93,96,106,107,108,109,110,111,112,113,114,115,116,117,119,121,122,123,124,125,126,127,128,129,130,131,88,90,91,92,109,110,111,112,113,128,93,96,106,107,108,115,119,122,123,125,127,114,116,117,124,126,129,131,88,90,91,92,109,110,111,112,113,128,93,106,107,108,117,122,123,125,131,127,88,90,91,92,109,110,111,112,113,124,128,93,96,106,107,108,114,122,123,125,126,127,131,129,117,88,90,91,92,109,110,111,112,113,123,125,128,93,106,107,108,115,116,117,122,131,127,88,90,91,92,109,110,111,112,113,115,123,124,128,93,96,106,107,108,117,122,125,126,127,129,131,88,90,91,92,109,110,111,112,113,128,93,96,106,107,108,116,122,123,124,125,126,127,131,129,117,88,91,92,113,90,93,94,95,106,107,108,109,110,111,112,114,115,116,117,124,126,127,128,118,119,121,122,123,125,129,130,131,88,91,92,113,124,126,90,93,106,107,108,109,110,111,112,114,115,116,117,118,119,121,127,130,122,123,125,128,129,131,88,91,92,113,121,123,124,125,126,90,93,106,107,108,109,110,111,112,114,115,116,117,118,119,127,130,122,128,129,131,88,91,92,106,113,115,123,124,90,93,107,108,112,117,128,129,131,127,88,91,92,113,126,90,93,106,107,108,112,117,128,129,131,127,88,91,92,106,107,109,110,113,115,116,122,123,124,125,126,127,128,129,130,131,90,93,108,112,117,88,91,92,106,107,109,110,111,113,115,116,122,123,124,125,126,127,128,129,130,131,90,93,108,112,117,132,135,136,157,134,153,154,155,158,159,138,139,160,162,163,165,166,167,168,169,170,172,173,174,175,133,137,140,150,151,152,156,161,171,132,135,136,157,134,137,150,151,166,167,169,175,152,171,132,135,136,157,133,140,154,166,167,153,155,158,159,160,168,169,170,172,173,175,134,137,150,151,152,156,161,171,132,134,135,136,153,154,155,156,157,172,133,140,152,159,166,167,169,158,160,168,170,173,175,137,150,151,161,171,132,135,136,157,133,134,137,140,150,151,152,153,154,155,156,158,159,138,139,160,161,162,163,165,166,167,168,169,170,171,172,173,174,175,132,135,136,150,151,157,168,170,133,134,137,140,152,153,154,155,158,159,160,166,167,169,172,173,175,156,161,171,132,135,136,150,157,168,133,134,137,153,154,155,156,158,159,160,163,165,166,167,169,172,162,170,173,174,175,140,151,152,161,171,132,135,136,150,151,154,155,157,159,160,165,167,168,169,170,133,134,137,140,152,153,158,166,172,173,175,156,161,171,132,135,136,150,154,157,159,167,168,133,134,137,153,155,156,158,160,161,163,165,166,169,172,173,162,170,174,175,140,151,152,171,132,135,136,157,133,134,137,153,154,155,156,158,159,160,161,163,165,166,167,169,172,173,162,168,170,174,175,140,150,151,152,171,132,135,136,157,134,137,150,151,152,153,154,156,161,168,170,166,167,169,171,175,132,135,136,150,157,168,134,137,151,166,167,169,175,152,171,132,135,136,150,154,157,159,167,168,134,137,151,156,166,169,175,152,171,132,135,136,157,134,137,150,151,156,166,167,169,175,152,171,132,134,135,136,153,154,155,156,157,172,137,150,151,167,166,169,175,152,171,132,135,136,157,134,137,140,150,151,152,154,166,167,153,155,156,158,159,160,161,168,169,170,171,172,173,175,132,135,136,157,134,137,150,151,152,156,161,166,167,169,175,171,132,135,136,157,168,134,137,140,150,151,152,153,166,167,169,170,172,173,175,156,161,171,132,135,136,157,167,169,134,137,150,151,152,154,155,156,161,166,175,171,132,135,136,154,157,159,167,168,134,137,140,150,151,152,156,166,169,170,171,172,175,173,161,132,135,136,157,134,137,140,150,151,152,155,166,167,168,169,170,171,175,172,173,156,161,132,134,135,136,137,140,150,151,152,153,154,155,156,157,158,159,160,161,163,165,166,167,168,169,170,171,172,173,174,175,132,134,135,136,153,154,155,156,157,172,137,140,150,151,152,159,163,166,167,169,171,158,160,161,168,170,173,175,132,134,135,136,153,154,155,156,157,172,137,150,151,152,161,166,167,169,175,171,132,134,135,136,153,154,155,156,157,168,172,137,140,150,151,152,158,166,167,169,170,171,175,173,161,132,134,135,136,153,154,155,156,157,167,169,172,137,150,151,152,159,160,161,166,175,171,132,134,135,136,153,154,155,156,157,159,167,168,172,137,140,150,151,152,161,166,169,170,171,173,175,132,134,135,136,153,154,155,156,157,172,137,140,150,151,152,160,166,167,168,169,170,171,175,173,161,132,135,136,157,134,137,138,139,150,151,152,153,154,155,156,158,159,160,161,168,170,171,172,162,163,165,166,167,169,173,174,175,132,135,136,157,168,170,134,137,150,151,152,153,154,155,156,158,159,160,161,162,163,165,171,174,166,167,169,172,173,175,132,135,136,157,165,167,168,169,170,134,137,150,151,152,153,154,155,156,158,159,160,161,162,163,171,174,166,172,173,175,132,135,136,150,157,159,167,168,134,137,151,152,156,161,172,173,175,171,132,135,136,157,170,134,137,150,151,152,156,161,172,173,175,171,132,135,136,150,151,153,154,157,159,160,166,167,168,169,170,171,172,173,174,175,134,137,152,156,161,132,135,136,150,151,153,154,155,157,159,160,166,167,168,169,170,171,172,173,174,175,134,137,152,156,161,176,179,180,201,178,197,198,199,202,203,182,183,204,206,207,209,210,211,212,213,214,216,217,218,219,177,181,184,194,195,196,200,205,215,176,179,180,201,178,181,194,195,210,211,213,219,196,215,176,179,180,201,177,184,198,210,211,197,199,202,203,204,212,213,214,216,217,219,178,181,194,195,196,200,205,215,176,178,179,180,197,198,199,200,201,216,177,184,196,203,210,211,213,202,204,212,214,217,219,181,194,195,205,215,176,179,180,201,177,178,181,184,194,195,196,197,198,199,200,202,203,182,183,204,205,206,207,209,210,211,212,213,214,215,216,217,218,219,176,179,180,194,195,201,212,214,177,178,181,184,196,197,198,199,202,203,204,210,211,213,216,217,219,200,205,215,176,179,180,194,201,212,177,178,181,197,198,199,200,202,203,204,207,209,210,211,213,216,206,214,217,218,219,184,195,196,205,215,176,179,180,194,195,198,199,201,203,204,209,211,212,213,214,177,178,181,184,196,197,202,210,216,217,219,200,205,215,176,179,180,194,198,201,203,211,212,177,178,181,197,199,200,202,204,205,207,209,210,213,216,217,206,214,218,219,184,195,196,215,176,179,180,201,177,178,181,197,198,199,200,202,203,204,205,207,209,210,211,213,216,217,206,212,214,218,219,184,194,195,196,215,176,179,180,201,178,181,194,195,196,197,198,200,205,212,214,210,211,213,215,219,176,179,180,194,201,212,178,181,195,210,211,213,219,196,215,176,179,180,194,198,201,203,211,212,178,181,195,200,210,213,219,196,215,176,179,180,201,178,181,194,195,200,210,211,213,219,196,215,176,178,179,180,197,198,199,200,201,216,181,194,195,211,210,213,219,196,215,176,179,180,201,178,181,194,195,196,200,205,210,211,213,219,215,176,179,180,201,212,178,181,184,194,195,196,197,210,211,213,214,216,217,219,200,205,215,176,179,180,201,211,213,178,181,194,195,196,198,199,200,205,210,219,215,176,179,180,198,201,203,211,212,178,181,184,194,195,196,200,210,213,214,215,216,219,217,205,176,179,180,201,178,181,184,194,195,196,199,210,211,212,213,214,215,219,216,217,200,205,176,178,179,180,181,184,194,195,196,197,198,199,200,201,202,203,204,205,207,209,210,211,212,213,214,215,216,217,218,219,176,178,179,180,197,198,199,200,201,216,181,184,194,195,196,203,207,210,211,213,215,202,204,205,212,214,217,219,176,178,179,180,197,198,199,200,201,216,181,194,195,196,205,210,211,213,219,215,176,178,179,180,197,198,199,200,201,212,216,181,184,194,195,196,202,210,211,213,214,215,219,217,205,176,178,179,180,197,198,199,200,201,211,213,216,181,194,195,196,203,204,205,210,219,215,176,178,179,180,197,198,199,200,201,203,211,212,216,181,184,194,195,196,205,210,213,214,215,217,219,176,178,179,180,197,198,199,200,201,216,181,184,194,195,196,204,210,211,212,213,214,215,219,217,205,176,179,180,201,178,181,182,183,194,195,196,197,198,199,200,202,203,204,205,212,214,215,216,206,207,209,210,211,213,217,218,219,176,179,180,201,212,214,178,181,194,195,196,197,198,199,200,202,203,204,205,206,207,209,215,218,210,211,213,216,217,219,176,179,180,201,209,211,212,213,214,178,181,194,195,196,197,198,199,200,202,203,204,205,206,207,215,218,210,216,217,219,176,179,180,194,201,203,211,212,178,181,195,196,200,205,216,217,219,215,176,179,180,201,214,178,181,194,195,196,200,205,216,217,219,215,176,179,180,194,195,197,198,201,203,204,210,211,212,213,214,215,216,217,218,219,178,181,196,200,205,176,179,180,194,195,197,198,199,201,203,204,210,211,212,213,214,215,216,217,218,219,178,181,196,200,205,220,223,224,245,222,241,242,243,246,247,226,227,248,250,251,253,254,255,256,257,258,260,261,262,263,221,225,228,238,239,240,244,249,259,220,223,224,245,222,225,238,239,254,255,257,263,240,259,220,223,224,245,221,228,242,254,255,241,243,246,247,248,256,257,258,260,261,263,222,225,238,239,240,244,249,259,220,222,223,224,241,242,243,244,245,260,221,228,240,247,254,255,257,246,248,256,258,261,263,225,238,239,249,259,220,223,224,245,221,222,225,228,238,239,240,241,242,243,244,246,247,226,227,248,249,250,251,253,254,255,256,257,258,259,260,261,262,263,220,223,224,238,239,245,256,258,221,222,225,228,240,241,242,243,246,247,248,254,255,257,260,261,263,244,249,259,220,223,224,238,245,256,221,222,225,241,242,243,244,246,247,248,251,253,254,255,257,260,250,258,261,262,263,228,239,240,249,259,220,223,224,238,239,242,243,245,247,248,253,255,256,257,258,221,222,225,228,240,241,246,254,260,261,263,244,249,259,220,223,224,238,242,245,247,255,256,221,222,225,241,243,244,246,248,249,251,253,254,257,260,261,250,258,262,263,228,239,240,259,220,223,224,245,221,222,225,241,242,243,244,246,247,248,249,251,253,254,255,257,260,261,250,256,258,262,263,228,238,239,240,259,220,223,224,245,222,225,238,239,240,241,242,244,249,256,258,254,255,257,259,263,220,223,224,238,245,256,222,225,239,254,255,257,263,240,259,220,223,224,238,242,245,247,255,256,222,225,239,244,254,257,263,240,259,220,223,224,245,222,225,238,239,244,254,255,257,263,240,259,220,222,223,224,241,242,243,244,245,260,225,238,239,255,254,257,263,240,259,220,223,224,245,222,225,238,239,240,244,249,254,255,257,263,259,220,223,224,245,256,222,225,228,238,239,240,241,254,255,257,258,260,261,263,244,249,259,220,223,224,245,255,257,222,225,238,239,240,242,243,244,249,254,263,259,220,223,224,242,245,247,255,256,222,225,228,238,239,240,244,254,257,258,259,260,263,261,249,220,223,224,245,222,225,228,238,239,240,243,254,255,256,257,258,259,263,260,261,244,249,220,222,223,224,225,228,238,239,240,241,242,243,244,245,246,247,248,249,251,253,254,255,256,257,258,259,260,261,262,263,220,222,223,224,241,242,243,244,245,260,225,238,239,240,249,254,255,257,263,259,220,222,223,224,241,242,243,244,245,256,260,225,228,238,239,240,246,254,255,257,258,259,263,261,249,220,222,223,224,241,242,243,244,245,255,257,260,225,238,239,240,247,248,249,254,263,259,220,222,223,224,241,242,243,244,245,247,255,256,260,225,228,238,239,240,249,254,257,258,259,261,263,220,222,223,224,241,242,243,244,245,260,225,228,238,239,240,248,254,255,256,257,258,259,263,261,249,220,223,224,245,222,225,226,227,238,239,240,241,242,243,244,246,247,248,249,256,258,259,260,250,251,253,254,255,257,261,262,263,220,223,224,245,253,255,256,257,258,222,225,238,239,240,241,242,243,244,246,247,248,249,250,251,259,262,254,260,261,263,220,223,224,238,245,247,255,256,222,225,239,240,244,249,260,261,263,259,220,223,224,245,258,222,225,238,239,240,244,249,260,261,263,259,220,223,224,238,239,241,242,245,247,248,254,255,256,257,258,259,260,261,262,263,222,225,240,244,249,220,223,224,238,239,241,242,243,245,247,248,254,255,256,257,258,259,260,261,262,263,222,225,240,244,249]],([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,51,51,51,51,51,51,51,51,51,51,51,51,51,51,51,51,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,65,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,67,67,67,67,67,67,67,67,67,67,67,67,67,67,67,67,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,71,71,71,71,71,71,71,71,71,71,71,71,71,71,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,75,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,81,81,81,81,81,81,81,81,81,81,81,81,81,81,81,82,82,82,82,82,82,82,82,82,82,82,82,82,82,82,82,82,82,83,83,83,83,83,83,83,83,83,83,83,83,83,83,83,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,88,88,88,88,88,88,88,88,88,88,88,88,88,88,88,88,88,88,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,91,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,92,93,93,93,93,93,93,93,93,93,93,93,93,93,93,93,93,93,93,93,93,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,94,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,101,101,101,101,101,101,101,101,101,101,101,101,101,101,101,101,101,101,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,105,106,106,106,106,106,106,106,106,106,106,106,106,106,106,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,108,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,110,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,117,117,117,117,117,117,117,117,117,117,117,117,117,117,117,117,117,117,118,118,118,118,118,118,118,118,118,118,118,118,118,118,118,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,120,120,120,120,120,120,120,120,120,120,120,120,120,120,120,120,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,122,122,122,122,122,122,122,122,122,122,122,122,122,122,122,122,122,122,123,123,123,123,123,123,123,123,123,123,123,123,123,123,123,123,123,123,123,123,123,123,123,124,124,124,124,124,124,124,124,124,124,124,124,124,124,124,124,124,124,124,124,124,124,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,126,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,140,140,140,140,140,140,140,140,140,140,140,140,140,140,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170],[106,156,159,177,291,316,317,318,319,320,323,325,333,336,337,339,340,341,342,343,344,345,346,347,348,355,371,377,380,382,383,384,385,387,78,132,134,170,274,275,309,310,337,338,339,347,377,386,68,121,124,166,205,275,303,319,320,321,322,323,324,325,332,333,334,335,336,346,351,355,368,370,371,372,373,385,54,106,107,110,156,157,159,161,162,177,204,274,291,303,316,317,318,321,322,330,331,335,345,351,366,367,372,384,42,101,104,161,203,241,256,271,276,277,278,288,289,290,291,301,302,352,354,369,371,373,374,376,378,379,380,381,382,383,384,385,386,387,41,98,100,151,152,160,175,176,202,240,255,270,277,285,286,287,298,299,300,327,328,329,331,334,344,367,370,382,40,94,97,150,159,174,201,239,254,282,283,284,290,295,296,297,306,308,313,314,315,318,325,329,333,339,343,358,362,365,369,381,39,92,96,149,151,154,155,158,164,165,169,172,173,174,175,200,238,253,269,276,281,294,326,330,332,342,366,368,380,38,90,95,148,153,157,163,171,172,199,237,252,280,283,289,293,296,302,305,307,312,314,317,320,324,328,338,341,357,361,364,379,37,89,94,156,198,236,251,279,280,282,288,292,293,295,301,304,306,311,312,313,316,319,323,326,327,337,340,356,359,360,363,378,24,76,77,135,209,213,269,270,271,272,273,274,275,309,310,374,375,376,377,386,23,73,75,130,134,169,208,212,268,306,307,308,339,358,376,22,72,74,129,131,133,136,167,168,207,211,267,273,305,307,338,357,375,21,71,73,132,206,210,265,266,272,304,305,306,337,356,374,20,68,69,70,121,122,124,126,127,166,204,261,262,303,321,322,335,351,372,19,66,67,126,197,203,213,253,255,256,260,301,302,349,350,351,352,353,354,355,368,369,370,371,372,373,385,18,64,65,125,196,202,248,250,255,262,264,298,299,300,334,370,17,60,63,124,165,195,201,212,245,249,254,258,295,296,297,300,322,325,333,350,354,369,16,59,62,123,164,165,194,200,244,248,253,257,259,261,263,294,332,368,15,58,61,120,122,128,163,164,193,199,211,243,247,252,260,293,296,299,302,303,320,324,353,14,57,60,121,192,198,210,242,246,251,258,292,293,294,295,298,301,319,321,323,349,352,13,54,55,56,68,78,103,105,106,107,108,110,112,113,121,122,124,126,132,134,156,157,158,159,160,161,162,166,170,177,12,42,52,53,101,102,104,106,112,161,197,209,238,240,241,260,272,288,289,290,291,349,350,351,366,367,372,384,11,41,50,51,98,99,100,105,111,160,196,233,235,240,262,285,286,287,331,367,10,40,46,49,94,95,97,104,110,155,159,195,208,230,234,239,258,282,283,284,287,290,318,322,350,9,39,45,48,92,93,96,103,109,154,155,158,194,229,233,238,257,259,261,281,330,366,8,38,44,47,90,91,95,102,108,120,153,154,157,193,207,228,232,237,260,280,283,286,289,303,317,7,37,43,46,89,90,94,101,107,156,192,206,227,231,236,258,279,280,281,282,285,288,316,321,349,6,37,40,106,184,191,198,201,224,225,226,236,237,239,241,251,252,254,256,276,277,278,291,355,356,358,363,364,365,371,377,383,5,35,36,105,151,152,183,190,222,223,225,231,232,234,240,246,247,249,255,264,266,268,277,310,360,361,362,367,370,382,4,33,34,103,130,148,149,150,151,182,189,218,222,224,227,228,230,238,242,243,245,253,263,265,276,309,359,366,368,380,3,30,32,81,99,117,144,145,181,188,216,221,232,247,286,299,328,361,2,29,31,98,147,180,187,214,215,220,231,246,285,298,327,360,1,26,28,80,82,85,86,96,115,116,140,141,142,143,146,150,155,165,169,174,179,186,219,230,245,0,25,27,79,81,83,84,86,93,114,115,137,138,139,141,145,148,154,164,168,172,178,185,217,228,243,106,156,159,177,291,316,317,318,319,320,323,325,333,336,337,339,340,341,342,343,344,345,346,347,348,355,371,377,380,382,383,384,385,387,78,132,134,170,274,275,309,310,337,338,339,347,377,386,68,121,124,166,205,275,303,319,320,321,322,323,324,325,332,333,334,335,336,346,351,355,368,370,371,372,373,385,54,106,107,110,156,157,159,161,162,177,204,274,291,303,316,317,318,321,322,330,331,335,345,351,366,367,372,384,42,101,104,161,203,241,256,271,276,277,278,288,289,290,291,301,302,352,354,369,371,373,374,376,378,379,380,381,382,383,384,385,386,387,41,98,100,151,152,160,175,176,202,240,255,270,277,285,286,287,298,299,300,327,328,329,331,334,344,367,370,382,40,94,97,150,159,174,201,239,254,282,283,284,290,295,296,297,306,308,313,314,315,318,325,329,333,339,343,358,362,365,369,381,39,92,96,149,151,154,155,158,164,165,169,172,173,174,175,200,238,253,269,276,281,294,326,330,332,342,366,368,380,38,90,95,148,153,157,163,171,172,199,237,252,280,283,289,293,296,302,305,307,312,314,317,320,324,328,338,341,357,361,364,379,37,89,94,156,198,236,251,279,280,282,288,292,293,295,301,304,306,311,312,313,316,319,323,326,327,337,340,356,359,360,363,378,24,76,77,135,209,213,269,270,271,272,273,274,275,309,310,374,375,376,377,386,23,73,75,130,134,169,208,212,268,306,307,308,339,358,376,22,72,74,129,131,133,136,167,168,207,211,267,273,305,307,338,357,375,21,71,73,132,206,210,265,266,272,304,305,306,337,356,374,20,68,69,70,121,122,124,126,127,166,204,261,262,303,321,322,335,351,372,19,66,67,126,197,203,213,253,255,256,260,301,302,349,350,351,352,353,354,355,368,369,370,371,372,373,385,18,64,65,125,196,202,248,250,255,262,264,298,299,300,334,370,17,60,63,124,165,195,201,212,245,249,254,258,295,296,297,300,322,325,333,350,354,369,16,59,62,123,164,165,194,200,244,248,253,257,259,261,263,294,332,368,15,58,61,120,122,128,163,164,193,199,211,243,247,252,260,293,296,299,302,303,320,324,353,14,57,60,121,192,198,210,242,246,251,258,292,293,294,295,298,301,319,321,323,349,352,13,54,55,56,68,78,103,105,106,107,108,110,112,113,121,122,124,126,132,134,156,157,158,159,160,161,162,166,170,177,12,42,52,53,101,102,104,106,112,161,197,209,238,240,241,260,272,288,289,290,291,349,350,351,366,367,372,384,11,41,50,51,98,99,100,105,111,160,196,233,235,240,262,285,286,287,331,367,10,40,46,49,94,95,97,104,110,155,159,195,208,230,234,239,258,282,283,284,287,290,318,322,350,9,39,45,48,92,93,96,103,109,154,155,158,194,229,233,238,257,259,261,281,330,366,8,38,44,47,90,91,95,102,108,120,153,154,157,193,207,228,232,237,260,280,283,286,289,303,317,7,37,43,46,89,90,94,101,107,156,192,206,227,231,236,258,279,280,281,282,285,288,316,321,349,6,37,40,106,184,191,198,201,224,225,226,236,237,239,241,251,252,254,256,276,277,278,291,355,356,358,363,364,365,371,377,383,5,35,36,105,151,152,183,190,222,223,225,231,232,234,240,246,247,249,255,264,266,268,277,310,360,361,362,367,370,382,4,33,34,103,130,148,149,150,151,182,189,218,222,224,227,228,230,238,242,243,245,253,263,265,276,309,359,366,368,380,3,30,32,81,99,117,144,145,181,188,216,221,232,247,286,299,328,361,2,29,31,98,147,180,187,214,215,220,231,246,285,298,327,360,1,26,28,80,82,85,86,96,115,116,140,141,142,143,146,150,155,165,169,174,179,186,219,230,245,0,25,27,79,81,83,84,86,93,114,115,137,138,139,141,145,148,154,164,168,172,178,185,217,228,243,106,156,159,177,291,316,317,318,319,320,323,325,333,336,337,339,340,341,342,343,344,345,346,347,348,355,371,377,380,382,383,384,385,387,78,132,134,170,274,275,309,310,337,338,339,347,377,386,68,121,124,166,205,275,303,319,320,321,322,323,324,325,332,333,334,335,336,346,351,355,368,370,371,372,373,385,54,106,107,110,156,157,159,161,162,177,204,274,291,303,316,317,318,321,322,330,331,335,345,351,366,367,372,384,42,101,104,161,203,241,256,271,276,277,278,288,289,290,291,301,302,352,354,369,371,373,374,376,378,379,380,381,382,383,384,385,386,387,41,98,100,151,152,160,175,176,202,240,255,270,277,285,286,287,298,299,300,327,328,329,331,334,344,367,370,382,40,94,97,150,159,174,201,239,254,282,283,284,290,295,296,297,306,308,313,314,315,318,325,329,333,339,343,358,362,365,369,381,39,92,96,149,151,154,155,158,164,165,169,172,173,174,175,200,238,253,269,276,281,294,326,330,332,342,366,368,380,38,90,95,148,153,157,163,171,172,199,237,252,280,283,289,293,296,302,305,307,312,314,317,320,324,328,338,341,357,361,364,379,37,89,94,156,198,236,251,279,280,282,288,292,293,295,301,304,306,311,312,313,316,319,323,326,327,337,340,356,359,360,363,378,24,76,77,135,209,213,269,270,271,272,273,274,275,309,310,374,375,376,377,386,23,73,75,130,134,169,208,212,268,306,307,308,339,358,376,22,72,74,129,131,133,136,167,168,207,211,267,273,305,307,338,357,375,21,71,73,132,206,210,265,266,272,304,305,306,337,356,374,20,68,69,70,121,122,124,126,127,166,204,261,262,303,321,322,335,351,372,19,66,67,126,197,203,213,253,255,256,260,301,302,349,350,351,352,353,354,355,368,369,370,371,372,373,385,18,64,65,125,196,202,248,250,255,262,264,298,299,300,334,370,17,60,63,124,165,195,201,212,245,249,254,258,295,296,297,300,322,325,333,350,354,369,16,59,62,123,164,165,194,200,244,248,253,257,259,261,263,294,332,368,15,58,61,120,122,128,163,164,193,199,211,243,247,252,260,293,296,299,302,303,320,324,353,14,57,60,121,192,198,210,242,246,251,258,292,293,294,295,298,301,319,321,323,349,352,13,54,55,56,68,78,103,105,106,107,108,110,112,113,121,122,124,126,132,134,156,157,158,159,160,161,162,166,170,177,12,42,52,53,101,102,104,106,112,161,197,209,238,240,241,260,272,288,289,290,291,349,350,351,366,367,372,384,11,41,50,51,98,99,100,105,111,160,196,233,235,240,262,285,286,287,331,367,10,40,46,49,94,95,97,104,110,155,159,195,208,230,234,239,258,282,283,284,287,290,318,322,350,9,39,45,48,92,93,96,103,109,154,155,158,194,229,233,238,257,259,261,281,330,366,8,38,44,47,90,91,95,102,108,120,153,154,157,193,207,228,232,237,260,280,283,286,289,303,317,7,37,43,46,89,90,94,101,107,156,192,206,227,231,236,258,279,280,281,282,285,288,316,321,349,6,37,40,106,184,191,198,201,224,225,226,236,237,239,241,251,252,254,256,276,277,278,291,355,356,358,363,364,365,371,377,383,5,35,36,105,151,152,183,190,222,223,225,231,232,234,240,246,247,249,255,264,266,268,277,310,360,361,362,367,370,382,4,33,34,103,130,148,149,150,151,182,189,218,222,224,227,228,230,238,242,243,245,253,263,265,276,309,359,366,368,380,3,30,32,81,99,117,144,145,181,188,216,221,232,247,286,299,328,361,2,29,31,98,147,180,187,214,215,220,231,246,285,298,327,360,1,26,28,80,82,85,86,96,115,116,140,141,142,143,146,150,155,165,169,174,179,186,219,230,245,0,25,27,79,81,83,84,86,93,114,115,137,138,139,141,145,148,154,164,168,172,178,185,217,228,243,106,156,159,177,291,316,317,318,319,320,323,325,333,336,337,339,340,341,342,343,344,345,346,347,348,355,371,377,380,382,383,384,385,387,78,132,134,170,274,275,309,310,337,338,339,347,377,386,68,121,124,166,205,275,303,319,320,321,322,323,324,325,332,333,334,335,336,346,351,355,368,370,371,372,373,385,54,106,107,110,156,157,159,161,162,177,204,274,291,303,316,317,318,321,322,330,331,335,345,351,366,367,372,384,42,101,104,161,203,241,256,271,276,277,278,288,289,290,291,301,302,352,354,369,371,373,374,376,378,379,380,381,382,383,384,385,386,387,41,98,100,151,152,160,175,176,202,240,255,270,277,285,286,287,298,299,300,327,328,329,331,334,344,367,370,382,40,94,97,150,159,174,201,239,254,282,283,284,290,295,296,297,306,308,313,314,315,318,325,329,333,339,343,358,362,365,369,381,39,92,96,149,151,154,155,158,164,165,169,172,173,174,175,200,238,253,269,276,281,294,326,330,332,342,366,368,380,38,90,95,148,153,157,163,171,172,199,237,252,280,283,289,293,296,302,305,307,312,314,317,320,324,328,338,341,357,361,364,379,37,89,94,156,198,236,251,279,280,282,288,292,293,295,301,304,306,311,312,313,316,319,323,326,327,337,340,356,359,360,363,378,24,76,77,135,209,213,269,270,271,272,273,274,275,309,310,374,375,376,377,386,23,73,75,130,134,169,208,212,268,306,307,308,339,358,376,22,72,74,129,131,133,136,167,168,207,211,267,273,305,307,338,357,375,21,71,73,132,206,210,265,266,272,304,305,306,337,356,374,20,68,69,70,121,122,124,126,127,166,204,261,262,303,321,322,335,351,372,18,64,65,125,196,202,248,250,255,262,264,298,299,300,334,370,17,60,63,124,165,195,201,212,245,249,254,258,295,296,297,300,322,325,333,350,354,369,16,59,62,123,164,165,194,200,244,248,253,257,259,261,263,294,332,368,15,58,61,120,122,128,163,164,193,199,211,243,247,252,260,293,296,299,302,303,320,324,353,14,57,60,121,192,198,210,242,246,251,258,292,293,294,295,298,301,319,321,323,349,352,13,54,55,56,68,78,103,105,106,107,108,110,112,113,121,122,124,126,132,134,156,157,158,159,160,161,162,166,170,177,12,42,52,53,101,102,104,106,112,161,197,209,238,240,241,260,272,288,289,290,291,349,350,351,366,367,372,384,11,41,50,51,98,99,100,105,111,160,196,233,235,240,262,285,286,287,331,367,10,40,46,49,94,95,97,104,110,155,159,195,208,230,234,239,258,282,283,284,287,290,318,322,350,9,39,45,48,92,93,96,103,109,154,155,158,194,229,233,238,257,259,261,281,330,366,8,38,44,47,90,91,95,102,108,120,153,154,157,193,207,228,232,237,260,280,283,286,289,303,317,7,37,43,46,89,90,94,101,107,156,192,206,227,231,236,258,279,280,281,282,285,288,316,321,349,6,37,40,106,184,191,198,201,224,225,226,236,237,239,241,251,252,254,256,276,277,278,291,355,356,358,363,364,365,371,377,383,5,35,36,105,151,152,183,190,222,223,225,231,232,234,240,246,247,249,255,264,266,268,277,310,360,361,362,367,370,382,4,33,34,103,130,148,149,150,151,182,189,218,222,224,227,228,230,238,242,243,245,253,263,265,276,309,359,366,368,380,3,30,32,81,99,117,144,145,181,188,216,221,232,247,286,299,328,361,2,29,31,98,147,180,187,214,215,220,231,246,285,298,327,360,1,26,28,80,82,85,86,96,115,116,140,141,142,143,146,150,155,165,169,174,179,186,219,230,245,0,25,27,79,81,83,84,86,93,114,115,137,138,139,141,145,148,154,164,168,172,178,185,217,228,243,106,156,159,177,291,316,317,318,319,320,323,325,333,336,337,339,340,341,342,343,344,345,346,347,348,355,371,377,380,382,383,384,385,387,78,132,134,170,274,275,309,310,337,338,339,347,377,386,68,121,124,166,205,275,303,319,320,321,322,323,324,325,332,333,334,335,336,346,351,355,368,370,371,372,373,385,54,106,107,110,156,157,159,161,162,177,204,274,291,303,316,317,318,321,322,330,331,335,345,351,366,367,372,384,42,101,104,161,203,241,256,271,276,277,278,288,289,290,291,301,302,352,354,369,371,373,374,376,378,379,380,381,382,383,384,385,386,387,41,98,100,151,152,160,175,176,202,240,255,270,277,285,286,287,298,299,300,327,328,329,331,334,344,367,370,382,40,94,97,150,159,174,201,239,254,282,283,284,290,295,296,297,306,308,313,314,315,318,325,329,333,339,343,358,362,365,369,381,39,92,96,149,151,154,155,158,164,165,169,172,173,174,175,200,238,253,269,276,281,294,326,330,332,342,366,368,380,38,90,95,148,153,157,163,171,172,199,237,252,280,283,289,293,296,302,305,307,312,314,317,320,324,328,338,341,357,361,364,379,37,89,94,156,198,236,251,279,280,282,288,292,293,295,301,304,306,311,312,313,316,319,323,326,327,337,340,356,359,360,363,378,24,76,77,135,209,213,269,270,271,272,273,274,275,309,310,374,375,376,377,386,23,73,75,130,134,169,208,212,268,306,307,308,339,358,376,22,72,74,129,131,133,136,167,168,207,211,267,273,305,307,338,357,375,21,71,73,132,206,210,265,266,272,304,305,306,337,356,374,20,68,69,70,121,122,124,126,127,166,204,261,262,303,321,322,335,351,372,18,64,65,125,196,202,248,250,255,262,264,298,299,300,334,370,17,60,63,124,165,195,201,212,245,249,254,258,295,296,297,300,322,325,333,350,354,369,16,59,62,123,164,165,194,200,244,248,253,257,259,261,263,294,332,368,15,58,61,120,122,128,163,164,193,199,211,243,247,252,260,293,296,299,302,303,320,324,353,14,57,60,121,192,198,210,242,246,251,258,292,293,294,295,298,301,319,321,323,349,352,13,54,55,56,68,78,103,105,106,107,108,110,112,113,121,122,124,126,132,134,156,157,158,159,160,161,162,166,170,177,11,41,50,51,98,99,100,105,111,160,196,233,235,240,262,285,286,287,331,367,10,40,46,49,94,95,97,104,110,155,159,195,208,230,234,239,258,282,283,284,287,290,318,322,350,9,39,45,48,92,93,96,103,109,154,155,158,194,229,233,238,257,259,261,281,330,366,8,38,44,47,90,91,95,102,108,120,153,154,157,193,207,228,232,237,260,280,283,286,289,303,317,7,37,43,46,89,90,94,101,107,156,192,206,227,231,236,258,279,280,281,282,285,288,316,321,349,6,37,40,106,184,191,198,201,224,225,226,236,237,239,241,251,252,254,256,276,277,278,291,355,356,358,363,364,365,371,377,383,4,33,34,103,130,148,149,150,151,182,189,218,222,224,227,228,230,238,242,243,245,253,263,265,276,309,359,366,368,380,3,30,32,81,99,117,144,145,181,188,216,221,232,247,286,299,328,361,2,29,31,98,147,180,187,214,215,220,231,246,285,298,327,360,1,26,28,80,82,85,86,96,115,116,140,141,142,143,146,150,155,165,169,174,179,186,219,230,245,0,25,27,79,81,83,84,86,93,114,115,137,138,139,141,145,148,154,164,168,172,178,185,217,228,243])),shape=(171,388))

    M0 = csr_matrix((np.array([-L0,-L0,-L0,-L0,-L0,-L0,-L0,1,-L0,1,-L0,-L0,1,-L0,-L0,1,-L0,L0,2*L0,-L0**2,1,-L0,1,-L0,-L0,1,-L0,-L0,1,-L0,-L0,-L0,-L0,-L0,-L0,1,-L0,1,-L0,1,-L0,1,-L0,1,1,-L0,1,1,-L0,1,1,-L0,1,1,-L0,1,1,-L0,1,1,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,1,-L0,-L0,1,1,-L0,L0,2*L0,-L0**2,L0,2*L0,-L0**2,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,1,1,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-1,-1,-1,-1,1,-L0,1,-L0,1,-L0,-L0,-L0,1,-L0,1,-L0,-L0,1,-L0,-L0,-L0,-L0,1,1,-L0,1,1,-L0,1,1,-L0,1,1,-L0,1,1,-L0,1,1,-L0,-L0,-L0,-L0,-L0,-L0,-L0,L0,2*L0,-L0**2,-1,-L0,-L0,-L0,-L0,-L0,-L0,-L0,-1,-1,-L0,-L0,-L0,-L0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,-L0,1,1,-L0,-L0,1,1,-L0,-L0,1,1,-L0,-L0,-1,-1,-1,-L0,-1,-L0,-1,-1,-1,-1,-1,-1,1,1,-L0]),([0,1,2,3,4,5,6,7,7,8,8,9,10,10,11,12,12,13,13,13,14,14,15,15,16,17,17,18,19,19,20,21,22,23,24,33,33,34,34,35,35,36,36,37,37,37,38,38,38,39,39,39,40,40,40,41,41,41,42,42,42,43,44,45,46,47,48,49,50,51,52,52,53,54,54,54,55,55,55,56,56,56,57,58,59,60,61,62,63,64,65,66,67,68,68,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,89,89,90,90,91,91,92,93,94,94,95,95,96,97,97,98,99,100,101,101,101,102,102,102,103,103,103,104,104,104,105,105,105,106,106,106,107,108,109,110,111,112,113,113,113,120,121,122,123,124,125,126,127,129,130,132,133,134,135,142,145,147,148,149,150,151,152,153,154,155,156,156,156,157,157,157,158,159,159,159,160,161,161,161,162,163,164,165,166,167,170,171,172,173,174,175,176,177,177,177],[39,41,42,43,46,47,48,28,58,29,59,60,30,61,62,31,63,177,199,205,32,73,33,74,75,34,76,77,35,78,173,178,179,180,93,87,181,89,183,88,182,90,184,20,178,185,21,179,186,22,91,98,23,180,187,24,92,99,25,93,100,101,102,103,104,105,108,106,107,109,94,110,112,26,96,113,145,159,162,147,161,165,114,115,116,117,118,121,119,120,122,123,191,27,97,193,143,144,126,127,128,129,130,196,198,199,36,37,37,38,126,133,127,134,128,135,148,149,128,135,129,136,150,130,137,149,150,151,174,196,200,175,197,201,85,131,202,176,198,203,86,132,204,177,199,205,138,139,152,140,153,206,158,169,170,80,141,142,154,155,156,207,157,88,89,159,160,161,208,128,128,128,182,196,183,197,198,104,107,108,145,159,162,146,160,163,164,147,161,165,166,195,208,209,167,117,120,121,168,128,169,135,149,159,150,160,161,158,169,170])),shape=(178,210))
    M = M[:,178:]-M[:,:178]@M0 # Schur complement reduction
    M = M.toarray()

    p,L,_ = lu(M[:,:143],p_indices=True)
    p = np.argsort(p)
    M = M[p[-28:],143:]-L[-28:,:]@solve(L[:143,:],M[p[:143],143:])
    #Q,_ = qr(M[:,:143])
    #M = Q[:,-28:].T@M[:,143:]

    T0 = np.zeros((39,39))
    T0[[0,1,3,4,5,10,11,12,13,17,18,19,20,21,23,24,25,26,27,29,30,31,32,33,35,36,37,38],:] = -M[:,28:]
    T0.flat[[101,258,298,338,378,575,615,656,894,1129,1364]] = 1
    T1 = np.zeros((39,39))
    T1[np.ix_([0,1,3,4,5,10,11,12,13,17,18,19,20,21,23,24,25,26,27,29,30,31,32,33,35,36,37,38],[0,1,3,4,5,10,11,12,13,17,18,19,20,21,23,24,25,26,27,29,30,31,32,33,35,36,37,38])] = M[:,:28]
    T1.flat[[80,240,280,320,360,560,600,640,880,1120,1360]] = 1

    _,V = eig(T0,T1)
    S = V[29:38,:]/V[38,:]
    S = S[:,np.all(np.isfinite(S),axis=0)]

    return S



def S2Rt6p6p(S,C,U,RR,realOnly):

    k = 20 # number of true roots
    z = np.array([U(s) for s in S.T]).T
    z = z/norm(z,axis=0)
    e = norm(C@z,axis=0)
    I = np.argsort(e)
    S = S[:,I[:k]] # filter out false roots
    err = np.tile(e[I[:k]],(1,2)).flatten()

    if realOnly:
        c = np.all(np.isreal(S),axis=0) & (S[0,:]>0)
        S,err = S[:,c].real,err[np.tile(c,(1,2)).flatten()]
        Rt = np.empty((2*S.shape[1],3,4))
    else:
        Rt = np.empty((2*S.shape[1],3,4),dtype=complex)

    k = S.shape[1]
    for i in range(k):
        a = np.sqrt(S[0,i])
        Rt[i,:,0:3] = RR[0,:,:]@cayley(np.array([a, S[1,i]/a, S[5,i]]))@RR[1,:,:].T
        Rt[i,:,3] = RR[0,:,:]@np.array([S[6,i], S[7,i], S[2,i]/a])
        Rt[k+i,:,0:3] = RR[0,:,:]@cayley(np.array([-a, -S[1,i]/a, S[5,i]]))@RR[1,:,:].T
        Rt[k+i,:,3] = RR[0,:,:]@np.array([S[6,i], S[7,i], -S[2,i]/a])

    return Rt,err